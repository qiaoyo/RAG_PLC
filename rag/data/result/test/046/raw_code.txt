```st
VAR_INPUT
    ACT : REAL;  // 实际值
    SET : REAL;  // 设定值
    SUP : REAL;  // 上限
    OFS : REAL;  // 偏移量
    M_I : REAL;  // 手动输入
    MAN : BOOL;  // 手动模式
    RST : BOOL := FALSE;  // 复位标志
    KP : REAL := 1.0;  // 比例增益
    KI : REAL := 1.0;  // 积分增益
    LL : REAL := -1000.0;  // 输出下限
    LH : REAL := 1000.0;  // 输出上限
END_VAR

VAR_OUTPUT
    Y : REAL;  // 控制输出
    DIFF : REAL;  // 误差
    LIM : BOOL;  // 输出限制标志
END_VAR

VAR
    error : REAL;  // 当前误差
    integral : REAL;  // 积分项
    proportional : REAL;  // 比例项
    last_error : REAL;  // 上一次误差
END_VAR

// 计算误差
error := SET - ACT;

// 计算比例项
proportional := KP * error;

// 计算积分项
integral := integral + (error + last_error) * 0.5 * T;  // T为采样时间
integral := integral * KI;

// 防止积分饱和
IF integral > LH THEN
    integral := LH;
ELSIF integral < LL THEN
    integral := LL;
END_IF;

// 计算控制输出
Y := proportional + integral + OFS;

// 防止输出饱和
IF Y > LH THEN
    Y := LH;
ELSIF Y < LL THEN
    Y := LL;
END_IF;

// 更新上一次误差
last_error := error;

// 输出限制标志
LIM := (Y = LH) OR (Y = LL);

// 复位处理
IF RST THEN
    integral := 0.0;
    last_error := 0.0;
END_IF;
```